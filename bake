#!/usr/bin/env bash

# TODO: support windows builds/installs
#       copy dlls

# nsfu
cd "$(dirname "$0")"
if [ -f ".env" ]; then
  export $(grep -v '^#' .env | xargs -d '\n')
fi

INSTALL_DIR=`eval echo $INSTALL_DIR`
BUILD_CMD="uv run pyinstaller --add-data ui:ui --icon ui/favicon.ico --name yams main.py"
set -x

if [ "$1" = "run" ]; then
  echo "Unimplemented"
elif [ "$1" = "dev" ]; then
  export DEV=1
  uv run fastapi dev
elif [ "$1" = "install" ]; then
  mkdir -p $INSTALL_DIR
  $BUILD_CMD
  cp -r dist/yams $INSTALL_DIR

elif [ "$1" = "uninstall" ]; then
  rm $INSTALL_DIR/yams
elif [ "$1" = "build" ]; then
  $BUILD_CMD
elif [ "$1" = "clean" ]; then
  rm -rf build/ dist/ main.spec __pycache__
  uv run pyinstaller --clean
else
  set +x
  echo "Shiver me timbers!!.. Invalid arrghh - $1"
  exit 1
fi



